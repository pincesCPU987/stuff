<html>
  <head>
    <title>Convert Binary to Text</title>
  </head>
  <body>
    <textarea id="textarea" style="width:40%;height:90%;"></textarea>
    <textarea readonly id="output" style="width:40%;height:90%;"></textarea>
    <input type="button" id="copy" value="Copy">
    <br>
    <select id="from">
      <option value="bin">Binary</option>
      <option value="hex">Hexadecimal</option>
      <option value="dec">Decimal</option>
      <option value="oct">Octal</option>
      <option selected value="text">Text</option>
      <option value="base64">Base 64</option>
    </select>
    to
    <select id="to">
      <option selected value="bin">Binary</option>
      <option value="hex">Hexadecimal</option>
      <option value="dec">Decimal</option>
      <option value="oct">Octal</option>
      <option value="text">Text</option>
      <option value="base64">Base 64</option>
    </select>
    <input type="button" id="convert" value="Convert">
    <br>
    <input type="button" id="convertToText" value="Convert to text">
    <br>
    <input type="button" id="convertToBinary" value="Convert to binary">
    <script>
    	const digit="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_";
      toB64=x=>x.toString(2).split(/(?=(?:.{6})+(?!.))/g).map(v=>digit[parseInt(v,2)]).join("")
      fromB64=x=>x.split("").reduce((s,v)=>s*64+digit.indexOf(v),0)
      var text = document.querySelector('#textarea');
      var output = document.querySelector('#output');
      var copy = document.querySelector('#copy');
      var to = document.querySelector('#to');
      var from = document.querySelector('#from');
      copy.addEventListener('click',function(e){
      	output.select();
        document.execCommand('copy')
      })
      text.addEventListener('keydown', function(e) {
        if (e.key == 'Tab') {
          e.preventDefault();
          var start = this.selectionStart;
          var end = this.selectionEnd;

          // set textarea value to: text before caret + tab + text after caret
          this.value = this.value.substring(0, start) +
            "\t" + this.value.substring(end);

          // put caret at right position again
          this.selectionStart =
            this.selectionEnd = start + 1;
        }
      });
      var hex = {
        '0000':'0',
        '0001':'1',
        '0010':'2',
        '0011':'3',
        '0100':'4',
        '0101':'5',
        '0110':'6',
        '0111':'7',
        '1000':'8',
        '1001':'9',
        '1010':'a',
        '1011':'b',
        '1100':'c',
        '1101':'d',
        '1110':'e',
        '1111':'f'
      }
      var oct = [];
      function byteString(n) {
        if (n < 0 || n > 255 || n % 1 !== 0) {
            throw new Error(n + " does not fit in a byte");
        }
        return ("000000000" + n.toString(2)).substr(-8)
      }
      function correct(n){
      	return ("000000000" + n).substr(-8)
      }
      document.querySelector('#convert').addEventListener('click',function(){
        var str = '';
        var spl;
        var douspl;
        var byte1;
        var byte2;
        if(from.value == 'bin'){
        	spl = text.value.trim().split(' ');
          try {
          	for(var i = 0; i < spl.length; i++){
            	douspl = correct(spl[i]).split('')
              byte1 = douspl[0] + douspl[1] + douspl[2] + douspl[3];
              byte2 = douspl[4] + douspl[5] + douspl[6] + douspl[7];
            	str = str + eval('0x' + hex[byte1] + hex[byte2]) + ' ';
            }
          } catch(err){
         		alert('Error: Converting from binary failed beause you probably did not input correct binary code (remember, 1s and 0s, with a space delimeter)')
          	str = 'Error';
          }
        } else if(from.value == 'text'){
        	spl = text.value.split('');
          for(var i = 0; i < spl.length; i++){
          	str = str + spl[i].charCodeAt() + ' ';
          }
        } else if(from.value == 'dec'){
        	spl = Number(text.value.trim());
        } else if(from.value == 'hex'){
        	try {
          	spl = eval('0x' + text.value.trim());
          } catch(err){
          	alert('Error: Converting from hexadecimal failed probably because it is not hexadecimal.')
            str = 'Error'
          }
        } else if(from.value == 'oct'){
        	spl = text.value.trim().split('');
          if(!spl.isNaN()){
          	for(var i = 0; i < spl.length; i++){
            	str = Number(str) + (Number(spl[i]) * Math.pow(8,spl.length - (i + 1))) 
            }
          } else {
          	alert('Error: Converting from octal failed because it is not a valid octal number');
            str = 'Error'
          }
        } else if(from.value == 'base64'){
        	spl = text.value.trim();
          str = fromB64(spl);
        }
        var final = '';
       	var newspl;
        if(to.value == 'bin'){
        	if(from.value == 'dec'){
          	final = str.toString(2);
          } else if(from.value == 'text'){
          	newspl = str.split(' ')
            for(var i = 0; i < newspl.length; i++){
            	
            }
          }
        }
        output.value = str;
      });
    </script>
  </body>
</html>
